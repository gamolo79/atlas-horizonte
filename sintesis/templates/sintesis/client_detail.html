{% extends "sintesis/base.html" %}
{% block title %}{{ client.name }} · Síntesis{% endblock %}
{% block content %}
  <div class="card">
    <div class="row" style="justify-content: space-between;">
      <div>
        <h2 class="section-title">{{ client.name }}</h2>
        <p class="muted">{{ client.description|default:"Sin descripción" }}</p>
        <div class="row">
          {% if client.persona %}<span class="badge">Persona: {{ client.persona.nombre_completo }}</span>{% endif %}
          {% if client.institucion %}<span class="badge">Institución: {{ client.institucion.nombre }}</span>{% endif %}
        </div>
      </div>
      <div class="row">
        <a class="btn secondary" href="{% url 'sintesis:client_edit' client.id %}">Editar</a>
        <a class="btn ghost" href="{% url 'sintesis:client_reports' client.id %}">Historial</a>
      </div>
    </div>
    <div class="row" style="margin-top:12px;">
      <form method="post" action="{% url 'sintesis:client_generate' client.id %}">
        {% csrf_token %}
        <button class="btn" type="submit">Generar ahora</button>
      </form>
    </div>
  </div>

  <div class="grid two" style="margin-top:16px;">
    <div class="card">
      <h3 class="section-title">Secciones</h3>
      <div class="list">
        {% for section in sections %}
          <div class="item">
            <strong>{{ section.title }}</strong>
            <div class="muted">Orden {{ section.order }} · {{ section.get_section_type_display }}</div>
          </div>
        {% empty %}
          <p class="muted">No hay secciones configuradas.</p>
        {% endfor %}
      </div>
    </div>
    <div class="card">
      <h3 class="section-title">Programaciones</h3>
      <div class="list">
        {% for schedule in schedules %}
          <div class="item">
            <strong>{{ schedule.name|default:"Programación" }}</strong>
            <div class="muted">
              Próxima: {{ schedule.next_run_at|date:"d/m/Y H:i" }} · Ventana {{ schedule.window_start_time }} - {{ schedule.window_end_time }}
            </div>
          </div>
        {% empty %}
          <p class="muted">No hay schedules activos.</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:16px;">
    <h3 class="section-title">Últimos reportes</h3>
    <div class="list">
      {% for run in runs %}
        <div class="item">
          <div class="row" style="justify-content: space-between;">
            <div>
              <strong>Reporte #{{ run.id }}</strong>
              <div class="muted">{{ run.started_at|date:"d/m/Y H:i" }} · {{ run.get_run_type_display }}</div>
            </div>
            <a class="btn secondary" href="{% url 'sintesis:report_detail' run.id %}">Ver detalle</a>
          </div>
        </div>
      {% empty %}
        <p class="muted">No hay reportes generados.</p>
      {% endfor %}
    </div>
  </div>
{% endblock %}
