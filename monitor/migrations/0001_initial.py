# Generated by ChatGPT
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    initial = True

    dependencies = []

    operations = [
        migrations.CreateModel(
            name="IngestRun",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("action", models.CharField(max_length=100)),
                (
                    "status",
                    models.CharField(
                        choices=[("running", "Running"), ("success", "Success"), ("failed", "Failed")],
                        default="running",
                        max_length=20,
                    ),
                ),
                ("started_at", models.DateTimeField(auto_now_add=True)),
                ("finished_at", models.DateTimeField(blank=True, null=True)),
                ("time_window_start", models.DateTimeField(blank=True, null=True)),
                ("time_window_end", models.DateTimeField(blank=True, null=True)),
                ("stats_seen", models.IntegerField(default=0)),
                ("stats_new", models.IntegerField(default=0)),
                ("stats_errors", models.IntegerField(default=0)),
                ("log_text", models.TextField(blank=True)),
                ("error_text", models.TextField(blank=True)),
            ],
            options={
                "ordering": ["-started_at", "-id"],
            },
        ),
        migrations.CreateModel(
            name="MediaOutlet",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("name", models.CharField(max_length=200, unique=True)),
                ("site_url", models.URLField(blank=True)),
            ],
            options={
                "ordering": ["name"],
            },
        ),
        migrations.CreateModel(
            name="MediaSource",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("url", models.URLField()),
                ("source_type", models.CharField(default="rss", max_length=20)),
                ("is_active", models.BooleanField(default=True)),
                ("last_fetched_at", models.DateTimeField(blank=True, null=True)),
                ("last_error", models.TextField(blank=True)),
                (
                    "media_outlet",
                    models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="monitor.mediaoutlet"),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Article",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("url", models.URLField(unique=True)),
                ("title", models.TextField()),
                ("published_at", models.DateTimeField(blank=True, null=True)),
                ("fetched_at", models.DateTimeField(auto_now_add=True)),
                ("lead", models.TextField(blank=True)),
                ("body", models.TextField(blank=True)),
                ("language", models.CharField(blank=True, max_length=20)),
                ("hash_dedupe", models.CharField(blank=True, db_index=True, max_length=64)),
                ("pipeline_status", models.CharField(default="new", max_length=20)),
                (
                    "outlet",
                    models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="monitor.mediaoutlet"),
                ),
                (
                    "source",
                    models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="monitor.mediasource"),
                ),
            ],
            options={
                "ordering": ["-published_at", "-id"],
            },
        ),
        migrations.CreateModel(
            name="StoryCluster",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("cluster_key", models.CharField(blank=True, max_length=200)),
                ("headline", models.TextField()),
                ("lead", models.TextField(blank=True)),
                ("confidence", models.FloatField(default=0.0)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "base_article",
                    models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name="+", to="monitor.article"),
                ),
                (
                    "run",
                    models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="monitor.ingestrun"),
                ),
            ],
            options={
                "ordering": ["-created_at", "-id"],
            },
        ),
        migrations.CreateModel(
            name="StoryMention",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("match_score", models.FloatField(default=0.0)),
                ("is_base_candidate", models.BooleanField(default=False)),
                (
                    "article",
                    models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="monitor.article"),
                ),
                (
                    "cluster",
                    models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name="mentions", to="monitor.storycluster"),
                ),
                (
                    "media_outlet",
                    models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="monitor.mediaoutlet"),
                ),
            ],
        ),
        migrations.AddIndex(
            model_name="mediasource",
            index=models.Index(fields=["media_outlet", "is_active"], name="monitor_med_media_o_267ec5_idx"),
        ),
        migrations.AddIndex(
            model_name="mediasource",
            index=models.Index(fields=["last_fetched_at"], name="monitor_med_last_fe_a00609_idx"),
        ),
        migrations.AddIndex(
            model_name="article",
            index=models.Index(fields=["pipeline_status", "published_at"], name="monitor_art_pipeline_7a5e9b_idx"),
        ),
        migrations.AddIndex(
            model_name="article",
            index=models.Index(fields=["outlet", "published_at"], name="monitor_art_outlet_6d1e30_idx"),
        ),
        migrations.AddIndex(
            model_name="storycluster",
            index=models.Index(fields=["created_at"], name="monitor_sto_created_33fa25_idx"),
        ),
        migrations.AddIndex(
            model_name="storycluster",
            index=models.Index(fields=["run", "confidence"], name="monitor_sto_run_id_b0b1dc_idx"),
        ),
        migrations.AddIndex(
            model_name="storymention",
            index=models.Index(fields=["cluster", "media_outlet"], name="monitor_sto_cluster_424fa8_idx"),
        ),
        migrations.AddConstraint(
            model_name="storymention",
            constraint=models.UniqueConstraint(fields=("cluster", "article"), name="uniq_cluster_article"),
        ),
    ]
