{% extends "monitor/dashboard/base.html" %}

{% block content %}
<h1>Ingesta</h1>

<form method="post">
    {% csrf_token %}
    <button type="submit" name="action" value="fetch_sources">Correr fetch_sources</button>
    <button type="submit" name="action" value="cluster_articles_simple">Correr cluster_articles_simple</button>
</form>

<h2>Último fetch_sources</h2>
{% if last_fetch %}
    <p><strong>{{ last_fetch.status }}</strong> - {{ last_fetch.started_at }}</p>
    <p>Seen: {{ last_fetch.stats_seen }} | New: {{ last_fetch.stats_new }} | Errors: {{ last_fetch.stats_errors }}</p>
    <pre>{{ last_fetch.log_text }}</pre>
    {% if last_fetch.error_text %}
        <pre>{{ last_fetch.error_text }}</pre>
    {% endif %}
{% else %}
    <p>No hay ejecuciones todavía.</p>
{% endif %}

<h2>Último cluster_articles_simple</h2>
{% if last_cluster %}
    <p><strong>{{ last_cluster.status }}</strong> - {{ last_cluster.started_at }}</p>
    <p>Seen: {{ last_cluster.stats_seen }} | New: {{ last_cluster.stats_new }} | Errors: {{ last_cluster.stats_errors }}</p>
    <pre>{{ last_cluster.log_text }}</pre>
    {% if last_cluster.error_text %}
        <pre>{{ last_cluster.error_text }}</pre>
    {% endif %}
{% else %}
    <p>No hay ejecuciones todavía.</p>
{% endif %}
{% endblock %}
