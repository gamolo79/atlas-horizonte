{% extends "monitor/dashboard/base.html" %}
{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Benchmark de cobertura</h1>
        <p class="page-subtitle">
            Comparativa: {{ entity_a.nombre_completo|default:entity_a.nombre }} vs
            {{ entity_b.nombre_completo|default:entity_b.nombre }}.
        </p>
    </div>
    <div class="actions">
        <a class="secondary" href="{% url 'monitor_dashboard_benchmark' %}">Cambiar selección</a>
    </div>
</div>

<section class="card chart-card">
    <div class="chart-header">
        <h3 class="chart-title">Volumen de menciones (30 días)</h3>
        <div class="chart-subtitle">Comparativo diario entre ambos actores.</div>
    </div>
    <div class="chart-container">
        <canvas id="comparisonChart" aria-label="Volumen de menciones" role="img"></canvas>
    </div>
</section>

<section class="grid grid-2" style="margin-top: 20px;">
    <div class="card chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Sentimiento · {{ entity_a.nombre_completo|default:entity_a.nombre }}</h3>
            <div class="chart-subtitle">Distribución de tono por actor A.</div>
        </div>
        <div class="chart-container">
            <canvas id="sentA" aria-label="Sentimiento entidad A" role="img"></canvas>
        </div>
    </div>
    <div class="card chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Sentimiento · {{ entity_b.nombre_completo|default:entity_b.nombre }}</h3>
            <div class="chart-subtitle">Distribución de tono por actor B.</div>
        </div>
        <div class="chart-container">
            <canvas id="sentB" aria-label="Sentimiento entidad B" role="img"></canvas>
        </div>
    </div>
</section>

<script>
    const dates = JSON.parse('{{ chart_dates|safe }}');
    const dataA = JSON.parse('{{ chart_vol_a|safe }}');
    const dataB = JSON.parse('{{ chart_vol_b|safe }}');

    // Line Chart
    new Chart(document.getElementById("comparisonChart"), {
        type: 'line',
        data: {
            labels: dates,
            datasets: [
                {
                    label: "{% if entity_a.nombre_completo %}{{ entity_a.nombre_completo }}{% else %}{{ entity_a.nombre }}{% endif %}",
                    data: dataA,
                    borderColor: "#38bdf8",
                    backgroundColor: "rgba(56, 189, 248, 0.08)",
                    fill: false
                },
                {
                    label: "{% if entity_b.nombre_completo %}{{ entity_b.nombre_completo }}{% else %}{{ entity_b.nombre }}{% endif %}",
                    data: dataB,
                    borderColor: "#f97316",
                    backgroundColor: "rgba(249, 115, 22, 0.08)",
                    fill: false
                }
            ]
        },
        options: {
            maintainAspectRatio: false,
            scales: {
                x: { ticks: { color: "#cbd5f5" }, grid: { color: "rgba(148, 163, 184, 0.15)" } },
                y: { ticks: { color: "#cbd5f5" }, grid: { color: "rgba(148, 163, 184, 0.15)" } },
            },
            plugins: {
                legend: { labels: { color: "#e2e8f0" } },
            }
        }
    });

    // Pie Charts
    const pieConfig = {
        type: 'doughnut',
        data: { labels: ["Positivo", "Neutro", "Negativo"], datasets: [{ backgroundColor: ['#22c55e', '#94a3b8', '#ef4444'] }] },
        options: {
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: "#e2e8f0" } },
            }
        }
    };

    const configA = JSON.parse(JSON.stringify(pieConfig));
    configA.data.datasets[0].data = JSON.parse('{{ sent_a|safe }}');
    new Chart(document.getElementById("sentA"), configA);

    const configB = JSON.parse(JSON.stringify(pieConfig));
    configB.data.datasets[0].data = JSON.parse('{{ sent_b|safe }}');
    new Chart(document.getElementById("sentB"), configB);
</script>
{% endblock %}
