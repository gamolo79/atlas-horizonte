{% extends "monitor/dashboard/base.html" %}
{% block title %}Home · Monitor{% endblock %}
{% block content %}
  <div class="page-header">
    <div>
      <h1 class="page-title">Monitor Dashboard</h1>
      <p class="muted">Centro operativo para análisis, benchmarking y síntesis.</p>
    </div>
    <div class="actions">
      <a class="secondary" href="/monitor/dashboard/ingest/">Ingest/Digest</a>
      <a href="/monitor/dashboard/clients/">Clientes</a>
    </div>
  </div>

  <section class="grid grid-3">
    <div class="card">
      <div class="muted">Ingestas exitosas</div>
      <div class="kpi">{{ kpis.ingests_ok }}</div>
    </div>
    <div class="card">
      <div class="muted">Artículos hoy</div>
      <div class="kpi">{{ kpis.articles_today }}</div>
    </div>
    <div class="card">
      <div class="muted">Clusters hoy</div>
      <div class="kpi">{{ kpis.clusters_today }}</div>
    </div>
  </section>

  <section class="grid grid-2" style="margin-top: 20px;">
    <div class="card">
      <h3>Accesos rápidos</h3>
      <div class="actions" style="margin-top: 12px;">
        <a href="/monitor/dashboard/personas/">Personas</a>
        <a class="secondary" href="/monitor/dashboard/benchmark/">Benchmark</a>
        <a class="secondary" href="/monitor/dashboard/instituciones/">Instituciones</a>
      </div>
      <div class="actions" style="margin-top: 12px;">
        {% if digest_latest %}
          <a class="secondary" href="/monitor/dashboard/digests/{{ digest_latest.id }}/">Ver digest último</a>
        {% else %}
          <a class="secondary" href="/monitor/dashboard/ingest/">Sin digest aún</a>
        {% endif %}
        <a href="/monitor/dashboard/clients/">Gestionar clientes</a>
      </div>
    </div>
    <div class="card">
      <h3>Últimas ingestas</h3>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Status</th>
            <th>Ventana</th>
          </tr>
        </thead>
        <tbody>
          {% for run in recent_runs %}
            <tr>
              <td>#{{ run.id }}</td>
              <td><span class="tag">{{ run.get_status_display }}</span></td>
              <td>{{ run.time_window_start|date:"d M H:i" }} → {{ run.time_window_end|date:"d M H:i" }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="3" class="table-empty">No hay ingestas recientes.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
{% endblock %}
